<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test PDF Simple - Caf√© Luna</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 2rem;
            background: #f5f5f5;
            margin: 0;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #8B6F47;
            text-align: center;
            margin-bottom: 2rem;
        }
        .big-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            width: 100%;
            margin: 10px 0;
        }
        .big-btn:hover {
            background: #45a049;
        }
        .setup-btn {
            background: #2196F3;
        }
        .setup-btn:hover {
            background: #1976D2;
        }
        .result {
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
            font-family: monospace;
        }
        .success { color: #4CAF50; font-weight: bold; }
        .error { color: #F44336; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test PDF Simple</h1>
        
        <button class="big-btn setup-btn" onclick="createTestOrder()">
            1Ô∏è‚É£ CREATE TEST ORDER
        </button>
        
        <button class="big-btn" onclick="testSimplePDF()">
            2Ô∏è‚É£ TEST SIMPLE PDF
        </button>
        
        <div id="result" class="result">
            Status: Ready for testing...
        </div>
        
        <div style="text-align: center; margin-top: 2rem;">
            <a href="http://localhost:5140/RiwayatPesanan" target="_blank" style="display: inline-block; background: #8B6F47; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;">
                üìú Open Riwayat Pesanan
            </a>
        </div>
    </div>

    <script>
        function createTestOrder() {
            const result = document.getElementById('result');
            
            try {
                const testOrder = {
                    id: 'TEST' + Date.now().toString().slice(-6),
                    customer: {
                        name: 'Test Customer',
                        table: 'A1',
                        phone: '081234567890',
                        payment: 'cash',
                        notes: 'Test order'
                    },
                    items: [
                        { id: 1, name: 'Cappuccino Signature', price: 35000, quantity: 2 },
                        { id: 19, name: 'Tiramisu Slice', price: 45000, quantity: 1 }
                    ],
                    timestamp: new Date().toISOString(),
                    total: 115000,
                    status: 'completed'
                };
                
                localStorage.setItem('cappunabara_order_history', JSON.stringify([testOrder]));
                
                result.innerHTML = `
                    <span class="success">‚úÖ TEST ORDER CREATED!</span><br>
                    Order ID: ${testOrder.id}<br>
                    Customer: ${testOrder.customer.name}<br>
                    Total: Rp ${testOrder.total.toLocaleString('id-ID')}<br>
                    Status: Ready for PDF download test
                `;
                
            } catch (error) {
                result.innerHTML = `<span class="error">‚ùå Error: ${error.message}</span>`;
            }
        }
        
        function testSimplePDF() {
            const result = document.getElementById('result');
            
            try {
                const orderHistory = JSON.parse(localStorage.getItem('cappunabara_order_history') || '[]');
                
                if (orderHistory.length === 0) {
                    result.innerHTML = '<span class="error">‚ùå No orders found! Create test order first.</span>';
                    return;
                }
                
                const order = orderHistory[0];
                
                // Test the simple PDF function
                createSimplePDF(order);
                
                result.innerHTML = `
                    <span class="success">‚úÖ SIMPLE PDF TEST EXECUTED!</span><br>
                    Order: ${order.id}<br>
                    Expected: New tab should open with simple PDF struk<br>
                    Action: Click "PRINT/SAVE PDF" in the new tab<br>
                    Result: PDF file will be saved to your computer
                `;
                
            } catch (error) {
                result.innerHTML = `<span class="error">‚ùå Test Error: ${error.message}</span>`;
            }
        }
        
        // Simple PDF function - BULLETPROOF VERSION
        function createSimplePDF(order) {
            console.log('Creating simple PDF for order:', order.id);
            
            // Calculate totals
            const subtotal = order.total;
            const tax = subtotal * 0.1;
            const finalTotal = subtotal + tax;
            const orderDate = new Date(order.timestamp);
            
            // Create simple HTML content
            const htmlContent = '<!DOCTYPE html>' +
'<html>' +
'<head>' +
'    <meta charset="UTF-8">' +
'    <title>Struk Cafe Luna - ' + order.id + '</title>' +
'    <style>' +
'        body { font-family: Arial, sans-serif; padding: 20px; margin: 0; }' +
'        .struk { max-width: 400px; margin: 0 auto; border: 2px solid #8B6F47; padding: 20px; }' +
'        .header { text-align: center; margin-bottom: 20px; }' +
'        .brand { font-size: 24px; font-weight: bold; color: #8B6F47; }' +
'        .info { margin: 15px 0; }' +
'        .info-row { display: flex; justify-content: space-between; margin: 5px 0; }' +
'        .items { margin: 20px 0; }' +
'        .item { display: flex; justify-content: space-between; margin: 8px 0; }' +
'        .totals { margin-top: 20px; border-top: 2px solid #8B6F47; padding-top: 15px; }' +
'        .total-row { display: flex; justify-content: space-between; margin: 5px 0; }' +
'        .final-total { font-weight: bold; font-size: 18px; color: #8B6F47; }' +
'        .instructions { background: #e3f2fd; padding: 15px; margin-bottom: 20px; text-align: center; border-radius: 8px; }' +
'        .btn { background: #4CAF50; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 5px; }' +
'        @media print { .instructions { display: none; } }' +
'    </style>' +
'</head>' +
'<body>' +
'    <div class="instructions">' +
'        <h3>üì• CARA DOWNLOAD PDF:</h3>' +
'        <p><strong>1. Klik tombol "PRINT/SAVE PDF" di bawah</strong></p>' +
'        <p><strong>2. Pilih "Save as PDF" di dialog print</strong></p>' +
'        <p><strong>3. Klik "Save" untuk menyimpan</strong></p>' +
'        <button class="btn" onclick="window.print()">üñ®Ô∏è PRINT / SAVE PDF</button>' +
'        <button class="btn" style="background: #f44336;" onclick="window.close()">‚ùå TUTUP</button>' +
'    </div>' +
'    <div class="struk">' +
'        <div class="header">' +
'            <div style="font-size: 36px;">‚òï</div>' +
'            <div class="brand">CAF√â LUNA</div>' +
'            <div>Your Cozy Corner</div>' +
'        </div>' +
'        <div style="text-align: center; font-weight: bold; margin: 15px 0;">STRUK PEMBELIAN</div>' +
'        <div class="info">' +
'            <div class="info-row"><span>No. Pesanan:</span><span>' + order.id + '</span></div>' +
'            <div class="info-row"><span>Tanggal:</span><span>' + orderDate.toLocaleDateString('id-ID') + '</span></div>' +
'            <div class="info-row"><span>Waktu:</span><span>' + orderDate.toLocaleTimeString('id-ID') + '</span></div>' +
'            <div class="info-row"><span>Pelanggan:</span><span>' + order.customer.name + '</span></div>' +
'            <div class="info-row"><span>Meja:</span><span>' + order.customer.table + '</span></div>' +
'            <div class="info-row"><span>Pembayaran:</span><span>' + order.customer.payment + '</span></div>' +
'        </div>' +
'        <div class="items">' +
'            <div style="font-weight: bold; margin-bottom: 10px;">DETAIL PESANAN:</div>' +
            order.items.map(item => 
'                <div class="item">' +
'                    <span>' + item.name + ' x' + item.quantity + '</span>' +
'                    <span>Rp ' + (item.price * item.quantity).toLocaleString('id-ID') + '</span>' +
'                </div>'
            ).join('') +
'        </div>' +
'        <div class="totals">' +
'            <div class="total-row"><span>Subtotal:</span><span>Rp ' + subtotal.toLocaleString('id-ID') + '</span></div>' +
'            <div class="total-row"><span>Pajak (10%):</span><span>Rp ' + tax.toLocaleString('id-ID') + '</span></div>' +
'            <div class="total-row final-total"><span>TOTAL:</span><span>Rp ' + finalTotal.toLocaleString('id-ID') + '</span></div>' +
'        </div>' +
'        <div style="text-align: center; margin-top: 20px; font-size: 14px;">' +
'            <div style="font-weight: bold;">Terima kasih sudah berbelanja di Caf√© Luna! üíñ</div>' +
'            <div>üìû 0812-3456-7890 | üìß hello@cafeluna.com</div>' +
'            <div>üìç Jl. Kopi Hangat No. 123, Jakarta</div>' +
'        </div>' +
'    </div>' +
'    <script>' +
'        window.focus();' +
'        setTimeout(function() {' +
'            alert("CARA DOWNLOAD PDF:\\n\\n1. Klik tombol \\"PRINT/SAVE PDF\\"\\n2. Pilih \\"Save as PDF\\"\\n3. Klik \\"Save\\"\\n\\nStruk akan tersimpan sebagai file PDF!");' +
'        }, 1000);' +
'    </script>' +
'</body>' +
'</html>';
            
            // Open in new window
            const printWindow = window.open('', '_blank', 'width=800,height=1000');
            
            if (!printWindow) {
                alert('‚ùå POPUP DIBLOKIR!\\n\\nSilakan:\\n1. Allow popup untuk localhost:5140\\n2. Refresh halaman\\n3. Coba lagi');
                return;
            }
            
            // Write content and close
            printWindow.document.write(htmlContent);
            printWindow.document.close();
            printWindow.focus();
            
            // Show success message
            alert('‚úÖ STRUK BERHASIL DIBUKA!\\n\\nTab baru telah terbuka dengan struk.\\nKlik "PRINT/SAVE PDF" untuk download.');
            
            console.log('Simple PDF window opened successfully for order:', order.id);
        }
    </script>
</body>
</html>