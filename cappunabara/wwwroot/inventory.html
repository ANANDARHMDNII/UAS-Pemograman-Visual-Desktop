<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventori - Cappunabara</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
        }

        .navbar {
            background: linear-gradient(135deg, #8B4513 0%, #D2691E 100%);
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .navbar-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar-brand {
            font-size: 24px;
            font-weight: 600;
        }

        .nav-links {
            display: flex;
            gap: 20px;
        }

        .nav-link {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 20px;
            transition: background 0.3s ease;
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .page-header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title {
            font-size: 28px;
            color: #333;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #8B4513 0%, #D2691E 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            opacity: 0.9;
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .inventory-table {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .alerts-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            height: fit-content;
        }

        .section-title {
            font-size: 20px;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .table th,
        .table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        .table tbody tr:hover {
            background: #f8f9fa;
        }

        .stock-level {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .stock-high {
            background: #d4edda;
            color: #155724;
        }

        .stock-medium {
            background: #fff3cd;
            color: #856404;
        }

        .stock-low {
            background: #f8d7da;
            color: #721c24;
        }

        .stock-out {
            background: #f5c6cb;
            color: #721c24;
        }

        .alert-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            border-left: 4px solid;
        }

        .alert-warning {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }

        .alert-danger {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .alert-icon {
            font-size: 20px;
            margin-right: 15px;
        }

        .alert-content h4 {
            margin: 0 0 5px 0;
            font-size: 16px;
        }

        .alert-content p {
            margin: 0;
            font-size: 14px;
            opacity: 0.8;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            margin: 0 auto 15px;
        }

        .stat-card:nth-child(1) .stat-icon { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .stat-card:nth-child(2) .stat-icon { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .stat-card:nth-child(3) .stat-icon { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .stat-card:nth-child(4) .stat-icon { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }

        .stat-number {
            font-size: 28px;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        @media (max-width: 1024px) {
            .inventory-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .page-header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-content">
            <div class="navbar-brand">
                <i class="fas fa-boxes"></i>
                Cappunabara - Inventori
            </div>
            <div class="nav-links">
                <a href="modern-dashboard.html" class="nav-link">
                    <i class="fas fa-home"></i> Dashboard
                </a>
                <a href="order-system.html" class="nav-link">
                    <i class="fas fa-plus-circle"></i> Pesanan Baru
                </a>
                <a href="reports.html" class="nav-link">
                    <i class="fas fa-chart-bar"></i> Laporan
                </a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="page-header">
            <h1 class="page-title">Manajemen Inventori</h1>
            <div style="display: flex; gap: 15px; align-items: center;">
                <input type="text" id="search-input" placeholder="Cari item inventori..." style="padding: 10px 15px; border: 2px solid #e1e5e9; border-radius: 8px; width: 250px;">
                <select id="category-filter" style="padding: 10px 15px; border: 2px solid #e1e5e9; border-radius: 8px;">
                    <option value="">Semua Kategori</option>
                    <option value="Bahan Pokok">Bahan Pokok</option>
                    <option value="Protein">Protein</option>
                    <option value="Sayuran">Sayuran</option>
                    <option value="Bumbu">Bumbu</option>
                    <option value="Buah">Buah</option>
                    <option value="Minuman">Minuman</option>
                    <option value="Bahan Masak">Bahan Masak</option>
                    <option value="Pelengkap">Pelengkap</option>
                </select>
                <a href="inventory-history.html" class="btn" style="background: #6f42c1; color: white; text-decoration: none;">
                    <i class="fas fa-history"></i> Riwayat Stok
                </a>
                <a href="inventory-catalog.html" class="btn" style="background: #17a2b8; color: white; text-decoration: none;">
                    <i class="fas fa-book"></i> Katalog Lengkap
                </a>
                <button class="btn btn-primary" id="add-item-btn">
                    <i class="fas fa-plus"></i> Tambah Item
                </button>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-boxes"></i>
                </div>
                <div class="stat-number" id="total-items">28</div>
                <div class="stat-label">Total Item</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="stat-number" id="low-stock-count">6</div>
                <div class="stat-label">Stok Rendah</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-times-circle"></i>
                </div>
                <div class="stat-number" id="out-stock-count">1</div>
                <div class="stat-label">Stok Habis</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-money-bill-wave"></i>
                </div>
                <div class="stat-number" id="total-value">Rp 2.8M</div>
                <div class="stat-label">Nilai Inventori</div>
            </div>
        </div>

        <div class="inventory-grid">
            <div class="inventory-table">
                <h3 class="section-title">
                    <i class="fas fa-list"></i>
                    Daftar Inventori
                </h3>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Kategori</th>
                            <th>Stok</th>
                            <th>Unit</th>
                            <th>Harga</th>
                            <th>Status</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="inventory-tbody">
                        <!-- Data will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>

            <div class="alerts-panel">
                <h3 class="section-title">
                    <i class="fas fa-bell"></i>
                    Peringatan Stok
                </h3>
                <div id="stock-alerts">
                    <!-- Alerts will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script src="modern-auth.js"></script>
    <script>
        // Check authentication
        if (!isModernLoggedIn()) {
            window.location.href = 'modern-login.html';
        }

        // Inventory data sesuai dengan menu yang tersedia
        const inventoryData = [
            // BAHAN UNTUK MAKANAN
            {
                id: 1,
                name: 'Beras Premium',
                category: 'Bahan Pokok',
                stock: 50,
                unit: 'kg',
                price: 15000,
                minStock: 20,
                maxStock: 100,
                menuRelated: ['Nasi Gudeg Special', 'Nasi Liwet']
            },
            {
                id: 2,
                name: 'Ayam Segar',
                category: 'Protein',
                stock: 15,
                unit: 'kg',
                price: 35000,
                minStock: 10,
                maxStock: 50,
                menuRelated: ['Nasi Gudeg Special', 'Ayam Bakar Madu', 'Soto Ayam Lamongan']
            },
            {
                id: 3,
                name: 'Daging Sapi',
                category: 'Protein',
                stock: 8,
                unit: 'kg',
                price: 120000,
                minStock: 5,
                maxStock: 25,
                menuRelated: ['Rendang Daging', 'Rawon']
            },
            {
                id: 4,
                name: 'Ikan Lele',
                category: 'Protein',
                stock: 12,
                unit: 'kg',
                price: 25000,
                minStock: 8,
                maxStock: 30,
                menuRelated: ['Pecel Lele']
            },
            {
                id: 5,
                name: 'Telur Ayam',
                category: 'Protein',
                stock: 20,
                unit: 'kg',
                price: 28000,
                minStock: 15,
                maxStock: 40,
                menuRelated: ['Nasi Gudeg Special']
            },
            {
                id: 6,
                name: 'Tempe Segar',
                category: 'Protein',
                stock: 6,
                unit: 'kg',
                price: 8000,
                minStock: 10,
                maxStock: 25,
                menuRelated: ['Tempe Mendoan']
            },
            {
                id: 7,
                name: 'Tahu Putih',
                category: 'Protein',
                stock: 8,
                unit: 'kg',
                price: 6000,
                minStock: 10,
                maxStock: 20,
                menuRelated: ['Tahu Isi']
            },

            // SAYURAN DAN BUMBU
            {
                id: 8,
                name: 'Cabai Merah',
                category: 'Sayuran',
                stock: 5,
                unit: 'kg',
                price: 25000,
                minStock: 10,
                maxStock: 30,
                menuRelated: ['Semua menu pedas']
            },
            {
                id: 9,
                name: 'Bawang Merah',
                category: 'Bumbu',
                stock: 15,
                unit: 'kg',
                price: 18000,
                minStock: 10,
                maxStock: 25,
                menuRelated: ['Semua menu masakan']
            },
            {
                id: 10,
                name: 'Bawang Putih',
                category: 'Bumbu',
                stock: 12,
                unit: 'kg',
                price: 22000,
                minStock: 8,
                maxStock: 20,
                menuRelated: ['Semua menu masakan']
            },
            {
                id: 11,
                name: 'Jahe Segar',
                category: 'Bumbu',
                stock: 3,
                unit: 'kg',
                price: 15000,
                minStock: 5,
                maxStock: 15,
                menuRelated: ['Wedang Jahe']
            },
            {
                id: 12,
                name: 'Sayuran Gado-gado',
                category: 'Sayuran',
                stock: 10,
                unit: 'kg',
                price: 12000,
                minStock: 8,
                maxStock: 20,
                menuRelated: ['Gado-gado']
            },
            {
                id: 13,
                name: 'Jagung Pipil',
                category: 'Sayuran',
                stock: 8,
                unit: 'kg',
                price: 10000,
                minStock: 5,
                maxStock: 15,
                menuRelated: ['Bakwan Jagung']
            },
            {
                id: 14,
                name: 'Pisang Raja',
                category: 'Buah',
                stock: 15,
                unit: 'kg',
                price: 8000,
                minStock: 10,
                maxStock: 25,
                menuRelated: ['Pisang Goreng', 'Kolak Pisang']
            },

            // BAHAN MINUMAN
            {
                id: 15,
                name: 'Kopi Arabika',
                category: 'Minuman',
                stock: 5,
                unit: 'kg',
                price: 80000,
                minStock: 3,
                maxStock: 10,
                menuRelated: ['Kopi Tubruk', 'Cappuccino', 'Espresso', 'Americano']
            },
            {
                id: 16,
                name: 'Teh Hitam',
                category: 'Minuman',
                stock: 8,
                unit: 'kg',
                price: 25000,
                minStock: 5,
                maxStock: 15,
                menuRelated: ['Es Teh Manis']
            },
            {
                id: 17,
                name: 'Jeruk Segar',
                category: 'Buah',
                stock: 20,
                unit: 'kg',
                price: 15000,
                minStock: 15,
                maxStock: 40,
                menuRelated: ['Jus Jeruk']
            },
            {
                id: 18,
                name: 'Kelapa Muda',
                category: 'Buah',
                stock: 25,
                unit: 'buah',
                price: 8000,
                minStock: 20,
                maxStock: 50,
                menuRelated: ['Es Kelapa Muda']
            },

            // BAHAN DASAR
            {
                id: 19,
                name: 'Minyak Goreng',
                category: 'Bahan Masak',
                stock: 0,
                unit: 'liter',
                price: 18000,
                minStock: 10,
                maxStock: 30,
                menuRelated: ['Semua menu goreng']
            },
            {
                id: 20,
                name: 'Gula Pasir',
                category: 'Bahan Pokok',
                stock: 25,
                unit: 'kg',
                price: 12000,
                minStock: 15,
                maxStock: 40,
                menuRelated: ['Semua minuman manis']
            },
            {
                id: 21,
                name: 'Gula Merah',
                category: 'Bahan Pokok',
                stock: 8,
                unit: 'kg',
                price: 15000,
                minStock: 10,
                maxStock: 25,
                menuRelated: ['Wedang Jahe', 'Kolak Pisang', 'Es Cendol']
            },
            {
                id: 22,
                name: 'Santan Kelapa',
                category: 'Bahan Masak',
                stock: 30,
                unit: 'liter',
                price: 8000,
                minStock: 15,
                maxStock: 50,
                menuRelated: ['Rendang Daging', 'Es Cendol', 'Kolak Pisang']
            },
            {
                id: 23,
                name: 'Tepung Terigu',
                category: 'Bahan Pokok',
                stock: 40,
                unit: 'kg',
                price: 10000,
                minStock: 20,
                maxStock: 60,
                menuRelated: ['Tempe Mendoan', 'Pisang Goreng', 'Bakwan Jagung']
            },
            {
                id: 24,
                name: 'Kerupuk Udang',
                category: 'Pelengkap',
                stock: 50,
                unit: 'bungkus',
                price: 5000,
                minStock: 30,
                maxStock: 80,
                menuRelated: ['Kerupuk Udang']
            },

            // BAHAN DESSERT
            {
                id: 25,
                name: 'Tepung Ketan',
                category: 'Bahan Pokok',
                stock: 15,
                unit: 'kg',
                price: 12000,
                minStock: 10,
                maxStock: 25,
                menuRelated: ['Klepon', 'Es Cendol']
            },
            {
                id: 26,
                name: 'Kelapa Parut',
                category: 'Bahan Masak',
                stock: 10,
                unit: 'kg',
                price: 8000,
                minStock: 8,
                maxStock: 20,
                menuRelated: ['Klepon', 'Es Cendol']
            },
            {
                id: 27,
                name: 'Susu Segar',
                category: 'Minuman',
                stock: 20,
                unit: 'liter',
                price: 12000,
                minStock: 15,
                maxStock: 35,
                menuRelated: ['Cappuccino', 'Es Krim Vanilla', 'Puding Coklat']
            },
            {
                id: 28,
                name: 'Coklat Bubuk',
                category: 'Bahan Masak',
                stock: 5,
                unit: 'kg',
                price: 45000,
                minStock: 3,
                maxStock: 10,
                menuRelated: ['Puding Coklat']
            }
        ];

        let filteredInventoryData = [...inventoryData];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, inventory data:', inventoryData.length, 'items');
            updateStatistics();
            renderInventoryTable();
            renderStockAlerts();
            setupFilters();

            // Event delegation for action buttons
            document.getElementById('inventory-tbody').addEventListener('click', function(e) {
                const button = e.target.closest('button');
                if (!button) return;

                const itemId = parseInt(button.getAttribute('data-id'));
                console.log('Button clicked, item ID:', itemId);

                if (button.classList.contains('action-view')) {
                    viewItemAction(itemId);
                } else if (button.classList.contains('action-edit')) {
                    editItemAction(itemId);
                } else if (button.classList.contains('action-restock')) {
                    restockItemAction(itemId);
                }
            });

            // Add item button
            document.getElementById('add-item-btn').addEventListener('click', function() {
                addInventoryItemAction();
            });

            // Edit form handler
            document.getElementById('edit-item-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const itemId = parseInt(document.getElementById('edit-item-id').value);
                const itemIndex = inventoryData.findIndex(item => item.id === itemId);
                
                if (itemIndex !== -1) {
                    // Update item data
                    inventoryData[itemIndex] = {
                        ...inventoryData[itemIndex],
                        name: document.getElementById('edit-item-name').value,
                        category: document.getElementById('edit-item-category').value,
                        stock: parseInt(document.getElementById('edit-item-stock').value),
                        unit: document.getElementById('edit-item-unit').value,
                        price: parseInt(document.getElementById('edit-item-price').value),
                        minStock: parseInt(document.getElementById('edit-item-min-stock').value),
                        maxStock: parseInt(document.getElementById('edit-item-max-stock').value)
                    };
                    
                    // Update displays
                    updateStatistics();
                    filterInventory(); // This will re-render the table
                    renderStockAlerts();
                    
                    // Close modal and show success message
                    closeEditModal();
                    showNotification(`Item "${inventoryData[itemIndex].name}" berhasil diperbarui!`, 'success');
                }
            });

            // Add form handler
            document.getElementById('add-item-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Get new ID
                const newId = Math.max(...inventoryData.map(item => item.id)) + 1;
                
                // Create new item
                const newItem = {
                    id: newId,
                    name: document.getElementById('add-item-name').value,
                    category: document.getElementById('add-item-category').value,
                    stock: parseInt(document.getElementById('add-item-stock').value),
                    unit: document.getElementById('add-item-unit').value,
                    price: parseInt(document.getElementById('add-item-price').value),
                    minStock: parseInt(document.getElementById('add-item-min-stock').value),
                    maxStock: parseInt(document.getElementById('add-item-max-stock').value),
                    menuRelated: ['Item baru - belum dikaitkan dengan menu']
                };
                
                // Add to inventory
                inventoryData.push(newItem);
                
                // Update displays
                updateStatistics();
                filterInventory(); // This will re-render the table
                renderStockAlerts();
                
                // Close modal and show success message
                closeAddModal();
                showNotification(`Item "${newItem.name}" berhasil ditambahkan!`, 'success');
            });
            
            // Close modals when clicking outside
            document.getElementById('edit-item-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeEditModal();
                }
            });

            document.getElementById('add-item-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeAddModal();
                }
            });

            // Also close modals with Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeEditModal();
                    closeAddModal();
                }
            });
        });

        // Setup filters
        function setupFilters() {
            const searchInput = document.getElementById('search-input');
            const categoryFilter = document.getElementById('category-filter');
            
            searchInput.addEventListener('input', filterInventory);
            categoryFilter.addEventListener('change', filterInventory);
        }

        // Filter inventory
        function filterInventory() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const categoryFilter = document.getElementById('category-filter').value;
            
            filteredInventoryData = inventoryData.filter(item => {
                const matchesSearch = item.name.toLowerCase().includes(searchTerm) || 
                                    item.category.toLowerCase().includes(searchTerm);
                const matchesCategory = !categoryFilter || item.category === categoryFilter;
                return matchesSearch && matchesCategory;
            });
            
            renderInventoryTable();
        }

        // Update statistics
        function updateStatistics() {
            const totalItems = inventoryData.length;
            const lowStockItems = inventoryData.filter(item => {
                const status = getStockStatus(item);
                return status === 'low' || status === 'medium';
            }).length;
            const outOfStockItems = inventoryData.filter(item => getStockStatus(item) === 'out').length;
            const totalValue = inventoryData.reduce((sum, item) => sum + (item.stock * item.price), 0);

            document.getElementById('total-items').textContent = totalItems;
            document.getElementById('low-stock-count').textContent = lowStockItems;
            document.getElementById('out-stock-count').textContent = outOfStockItems;
            document.getElementById('total-value').textContent = `Rp ${(totalValue / 1000000).toFixed(1)}M`;
        }

        // Get stock status
        function getStockStatus(item) {
            if (item.stock === 0) return 'out';
            if (item.stock <= item.minStock) return 'low';
            if (item.stock <= item.minStock * 1.5) return 'medium';
            return 'high';
        }

        // Get stock status text
        function getStockStatusText(status) {
            switch(status) {
                case 'out': return 'Habis';
                case 'low': return 'Rendah';
                case 'medium': return 'Sedang';
                case 'high': return 'Aman';
                default: return 'Unknown';
            }
        }

        // Render inventory table
        function renderInventoryTable() {
            const tbody = document.getElementById('inventory-tbody');
            
            tbody.innerHTML = filteredInventoryData.map(item => {
                const status = getStockStatus(item);
                const statusText = getStockStatusText(status);
                const totalValue = item.stock * item.price;
                
                return `
                    <tr>
                        <td>
                            <strong>${item.name}</strong>
                            ${item.menuRelated ? `<br><small style="color: #666;">Menu: ${item.menuRelated.slice(0, 2).join(', ')}${item.menuRelated.length > 2 ? '...' : ''}</small>` : ''}
                        </td>
                        <td>${item.category}</td>
                        <td>${item.stock}</td>
                        <td>${item.unit}</td>
                        <td>Rp ${item.price.toLocaleString('id-ID')}</td>
                        <td>
                            <span class="stock-level stock-${status}">
                                ${statusText}
                            </span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-sm btn-info action-view" data-id="${item.id}" title="Lihat Detail">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-warning action-edit" data-id="${item.id}" title="Edit Item">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-success action-restock" data-id="${item.id}" title="Tambah Stok">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            if (filteredInventoryData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: #666;">
                            <i class="fas fa-search" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                            <p>Tidak ada item inventori yang ditemukan</p>
                        </td>
                    </tr>
                `;
            }
        }

        // Render stock alerts
        function renderStockAlerts() {
            const alertsContainer = document.getElementById('stock-alerts');
            const lowStockItems = inventoryData.filter(item => {
                const status = getStockStatus(item);
                return status === 'out' || status === 'low';
            });

            if (lowStockItems.length === 0) {
                alertsContainer.innerHTML = `
                    <div class="alert-item" style="background: #d4edda; border-color: #28a745; color: #155724;">
                        <div class="alert-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="alert-content">
                            <h4>Semua Stok Aman</h4>
                            <p>Tidak ada item dengan stok rendah</p>
                        </div>
                    </div>
                `;
                return;
            }

            alertsContainer.innerHTML = lowStockItems.map(item => {
                const status = getStockStatus(item);
                const alertClass = status === 'out' ? 'alert-danger' : 'alert-warning';
                const icon = status === 'out' ? 'fas fa-times-circle' : 'fas fa-exclamation-triangle';
                const message = status === 'out' ? 'Stok habis!' : `Stok rendah: ${item.stock} ${item.unit}`;

                return `
                    <div class="alert-item ${alertClass}">
                        <div class="alert-icon">
                            <i class="${icon}"></i>
                        </div>
                        <div class="alert-content">
                            <h4>${item.name}</h4>
                            <p>${message}</p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Remove old window function assignments - using event delegation instead

        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#28a745' : type === 'info' ? '#17a2b8' : '#ffc107'};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                z-index: 1001;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Action functions with event delegation
        function viewItemAction(id) {
            console.log('View item action called with ID:', id);
            const item = inventoryData.find(i => i.id === id);
            if (item) {
                const status = getStockStatusText(getStockStatus(item));
                const totalValue = item.stock * item.price;
                const relatedMenus = item.menuRelated ? item.menuRelated.join(', ') : 'Tidak ada';
                
                alert(`Detail Item Inventori:\n\nNama: ${item.name}\nKategori: ${item.category}\nStok: ${item.stock} ${item.unit}\nHarga Satuan: Rp ${item.price.toLocaleString('id-ID')}\nNilai Total: Rp ${totalValue.toLocaleString('id-ID')}\nStatus: ${status}\nMin Stock: ${item.minStock} ${item.unit}\nMax Stock: ${item.maxStock} ${item.unit}\n\nMenu Terkait:\n${relatedMenus}`);
            }
        }

        function editItemAction(id) {
            console.log('Edit item action called with ID:', id);
            const item = inventoryData.find(i => i.id === id);
            if (item) {
                console.log('Item found for edit:', item);
                // Populate edit modal
                document.getElementById('edit-item-id').value = item.id;
                document.getElementById('edit-item-name').value = item.name;
                document.getElementById('edit-item-category').value = item.category;
                document.getElementById('edit-item-stock').value = item.stock;
                document.getElementById('edit-item-unit').value = item.unit;
                document.getElementById('edit-item-price').value = item.price;
                document.getElementById('edit-item-min-stock').value = item.minStock;
                document.getElementById('edit-item-max-stock').value = item.maxStock;
                
                // Show edit modal
                document.getElementById('edit-item-modal').style.display = 'flex';
            } else {
                console.error('Item not found with ID:', id);
                showNotification('Item tidak ditemukan!', 'error');
            }
        }

        function restockItemAction(id) {
            console.log('Restock item action called with ID:', id);
            const item = inventoryData.find(i => i.id === id);
            if (item) {
                const quantity = prompt(`Tambah stok untuk "${item.name}":\nStok saat ini: ${item.stock} ${item.unit}\nStok minimum: ${item.minStock} ${item.unit}\nStok maksimum: ${item.maxStock} ${item.unit}\n\nMasukkan jumlah yang akan ditambahkan:`);
                
                if (quantity && !isNaN(quantity) && parseInt(quantity) > 0) {
                    const addedQuantity = parseInt(quantity);
                    const newStock = item.stock + addedQuantity;
                    
                    if (newStock > item.maxStock) {
                        if (confirm(`Stok akan melebihi maksimum (${item.maxStock} ${item.unit}). Lanjutkan?`)) {
                            item.stock = newStock;
                        } else {
                            return;
                        }
                    } else {
                        item.stock = newStock;
                    }
                    
                    updateStatistics();
                    renderInventoryTable();
                    renderStockAlerts();
                    showNotification(`Stok "${item.name}" berhasil ditambahkan ${addedQuantity} ${item.unit}!`, 'success');
                }
            }
        }

        function addInventoryItemAction() {
            console.log('Add inventory item action called');
            // Reset form
            document.getElementById('add-item-form').reset();
            
            // Show add modal
            document.getElementById('add-item-modal').style.display = 'flex';
        }

        // Close modal functions
        function closeEditModal() {
            document.getElementById('edit-item-modal').style.display = 'none';
        }

        function closeAddModal() {
            document.getElementById('add-item-modal').style.display = 'none';
        }

        // Global functions for modal management
        window.closeEditModal = closeEditModal;
        window.closeAddModal = closeAddModal;


    </script>

    <!-- Edit Item Modal -->
    <div class="modal" id="edit-item-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Item Inventori</h3>
                <button class="close-btn" onclick="closeEditModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="edit-item-form">
                    <input type="hidden" id="edit-item-id">
                    
                    <div class="form-group">
                        <label for="edit-item-name">Nama Item</label>
                        <input type="text" id="edit-item-name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-item-category">Kategori</label>
                        <select id="edit-item-category" required>
                            <option value="">Pilih Kategori</option>
                            <option value="Bahan Pokok">Bahan Pokok</option>
                            <option value="Protein">Protein</option>
                            <option value="Sayuran">Sayuran</option>
                            <option value="Bumbu">Bumbu</option>
                            <option value="Buah">Buah</option>
                            <option value="Minuman">Minuman</option>
                            <option value="Bahan Masak">Bahan Masak</option>
                            <option value="Pelengkap">Pelengkap</option>
                        </select>
                    </div>
                    
                    <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label for="edit-item-stock">Stok Saat Ini</label>
                            <input type="number" id="edit-item-stock" min="0" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-item-unit">Satuan</label>
                            <select id="edit-item-unit" required>
                                <option value="kg">Kilogram (kg)</option>
                                <option value="liter">Liter</option>
                                <option value="buah">Buah</option>
                                <option value="bungkus">Bungkus</option>
                                <option value="lembar">Lembar</option>
                                <option value="botol">Botol</option>
                                <option value="kaleng">Kaleng</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-item-price">Harga per Satuan (Rp)</label>
                        <input type="number" id="edit-item-price" min="0" required>
                    </div>
                    
                    <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label for="edit-item-min-stock">Stok Minimum</label>
                            <input type="number" id="edit-item-min-stock" min="0" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-item-max-stock">Stok Maksimum</label>
                            <input type="number" id="edit-item-max-stock" min="0" required>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 20px;">
                        <button type="button" class="btn" onclick="closeEditModal()" style="background: #6c757d; color: white;">
                            Batal
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Simpan Perubahan
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Item Modal -->
    <div class="modal" id="add-item-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Tambah Item Inventori Baru</h3>
                <button class="close-btn" onclick="closeAddModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="add-item-form">
                    <div class="form-group">
                        <label for="add-item-name">Nama Item</label>
                        <input type="text" id="add-item-name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="add-item-category">Kategori</label>
                        <select id="add-item-category" required>
                            <option value="">Pilih Kategori</option>
                            <option value="Bahan Pokok">Bahan Pokok</option>
                            <option value="Protein">Protein</option>
                            <option value="Sayuran">Sayuran</option>
                            <option value="Bumbu">Bumbu</option>
                            <option value="Buah">Buah</option>
                            <option value="Minuman">Minuman</option>
                            <option value="Bahan Masak">Bahan Masak</option>
                            <option value="Pelengkap">Pelengkap</option>
                        </select>
                    </div>
                    
                    <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label for="add-item-stock">Stok Awal</label>
                            <input type="number" id="add-item-stock" min="0" value="0" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="add-item-unit">Satuan</label>
                            <select id="add-item-unit" required>
                                <option value="">Pilih Satuan</option>
                                <option value="kg">Kilogram (kg)</option>
                                <option value="liter">Liter</option>
                                <option value="buah">Buah</option>
                                <option value="bungkus">Bungkus</option>
                                <option value="lembar">Lembar</option>
                                <option value="botol">Botol</option>
                                <option value="kaleng">Kaleng</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="add-item-price">Harga per Satuan (Rp)</label>
                        <input type="number" id="add-item-price" min="0" required>
                    </div>
                    
                    <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label for="add-item-min-stock">Stok Minimum</label>
                            <input type="number" id="add-item-min-stock" min="0" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="add-item-max-stock">Stok Maksimum</label>
                            <input type="number" id="add-item-max-stock" min="0" required>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 20px;">
                        <button type="button" class="btn" onclick="closeAddModal()" style="background: #6c757d; color: white;">
                            Batal
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Tambah Item
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <style>
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            background: linear-gradient(135deg, #8B4513 0%, #D2691E 100%);
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 15px 15px 0 0;
            position: relative;
        }

        .modal-body {
            padding: 25px;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #D2691E;
        }
    </style>
</body>
</html>